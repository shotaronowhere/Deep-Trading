# Deep Trading Bot

A Rust-based trading bot that rebalances portfolio according to predictions across a set of markets, specifically targeting deep funding markets. The bot connects to Ethereum via HTTP JSON-RPC and interacts with market contracts to execute trades.

## Features

- Connects to Ethereum nodes via HTTP JSON-RPC (Optimism RPC supported)
- Interfaces with market contracts to fetch outcome data
- Portfolio rebalancing based on ML predictions
- Uniswap V3 integration for efficient token swaps
- Batch routing via Solidity contracts for optimized execution

## Project Structure

```
Deep-Trading/
├── src/                    # Rust source code
│   ├── main.rs            # Entry point
│   ├── lib.rs             # Library root
│   ├── markets.rs         # Market data handling
│   ├── predictions.rs     # Prediction processing
│   ├── pools.rs           # Pool management
│   ├── execution/         # Trade execution logic
│   └── portfolio/         # Portfolio management
├── contracts/             # Solidity smart contracts
│   └── BatchRouter.sol   # Batch routing contract
├── docs/                  # Documentation
│   ├── architecture.md    # System architecture
│   ├── model.md           # ML model details
│   ├── portfolio.md       # Portfolio management
│   └── ...
├── test/                  # Smart contract tests
└── Cargo.toml             # Rust dependencies
```

## Getting Started

### Prerequisites

- Rust (2024 edition)
- Foundry (for Solidity contracts)

### Build

```bash
cd Deep-Trading
cargo build
```

### Run

Default runtime flow:
- fetches live L1 `slot0` data,
- optionally fetches wallet balances when `WALLET` is set,
- runs portfolio rebalance (`REBALANCE_MODE=full|arb_only`),
- prints initial/final portfolio snapshots from shared action replay,
- prints the shared execution diagnostics summary used in tests.

```bash
cargo run
```

Optional environment:
- `RPC` (default: `https://optimism.drpc.org`)
- `WALLET` (EVM address; if unset, runtime uses synthetic zero holdings + `STARTING_SUSD`)
- `STARTING_SUSD` (default `100.0`, only used when `WALLET` is unset)
- `RUST_LOG` (tracing filter; can be supplied via shell env or `.env`)
- `REBALANCE_MODE` (`full` default, or `arb_only`)
- `REBALANCE_FULL_MARKET_DELTAS=1` (full per-market deltas)
- `REBALANCE_FULL_PORTFOLIO=1` (full portfolio print)

## Documentation

See the [docs](./docs/) directory for detailed documentation:
- [Waterfall Algorithm (Canonical Spec)](./docs/waterfall.md) - Definitive waterfall/rebalance implementation behavior
- [Architecture](./docs/architecture.md) - System architecture overview
- [Model](./docs/model.md) - ML prediction model details
- [Portfolio](./docs/portfolio.md) - Portfolio management
- [Slippage](./docs/slippage.md) - Slippage analysis
